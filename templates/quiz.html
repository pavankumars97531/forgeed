<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Quiz - ForgeEd</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-logo">
                <h2>ForgeEd</h2>
                <p>AI-Enhanced LMS</p>
            </div>
            
            <div class="sidebar-nav">
                <a href="/dashboard" class="nav-item">
                    Dashboard
                </a>
                <a href="/courses" class="nav-item">
                    My Courses
                </a>
                <a href="/career-learning" class="nav-item">
                    Career Learning
                </a>
                <a href="/quiz" class="nav-item active">
                    <span>‚úçÔ∏è</span> Quizzes
                </a>
                <a href="/wellbeing" class="nav-item">
                    Wellbeing
                <a href="/analytics" class="nav-item">
                    Student Analytics
                </a>
                </a>
                <a href="/slu-gpt" class="nav-item">
                <a href="/profile" class="nav-item">
                    Profile
                </a>
                    SLU GPT
                </a>
            </div>
            
            <div class="sidebar-footer">
                <a href="/logout" class="logout-btn">
                    Logout
                </a>
            </div>
        </nav>

        <main class="main-content">
            <div class="page-header">
                <h1>üìù Daily Quiz</h1>
                <p>Test your knowledge with AI-generated quizzes</p>
            </div>

            <div class="quiz-sections">
                <!-- Career Learning Quiz -->
                <div class="quiz-section">
                    {% if career_quiz_today %}
                    <div class="quiz-completed-card">
                        <h2>üéØ Career Learning Quiz</h2>
                        <div class="quiz-result">
                            <div class="score-display">
                                <div class="score-big">{{ career_quiz_today['score'] }}/{{ career_quiz_today['total_questions'] }}</div>
                                <div class="score-label">Your Score</div>
                            </div>
                            <div class="ai-feedback-box">
                                <h4>ü§ñ AI Insights</h4>
                                <p>{{ career_quiz_today['ai_feedback'] }}</p>
                            </div>
                        </div>
                        <p class="next-quiz-message">‚ú® Come back tomorrow for a new quiz!</p>
                    </div>
                    {% else %}
                    <div class="quiz-header-card">
                        <h2>üéØ Career Learning Quiz</h2>
                        <p>10 questions based on today's learning topic</p>
                        <button class="start-quiz-btn" onclick="startCareerQuiz()">Start Career Quiz ‚Üí</button>
                    </div>
                    <div id="careerQuizContent"></div>
                    {% endif %}
                </div>

                <!-- Academic Quiz -->
                <div class="quiz-section">
                    {% if academic_quiz_today %}
                    <div class="quiz-completed-card">
                        <h2>üìö Academic Quiz</h2>
                        <div class="quiz-result">
                            <div class="score-display">
                                <div class="score-big">{{ academic_quiz_today['score'] }}/{{ academic_quiz_today['total_questions'] }}</div>
                                <div class="score-label">Your Score</div>
                            </div>
                            <div class="ai-feedback-box">
                                <h4>ü§ñ AI Insights</h4>
                                <p>{{ academic_quiz_today['ai_feedback'] }}</p>
                            </div>
                        </div>
                        <p class="next-quiz-message">‚ú® Come back tomorrow for a new quiz!</p>
                    </div>
                    {% else %}
                    <div class="quiz-header-card">
                        <h2>üìö Academic Quiz</h2>
                        <p>15 questions (5 from each of your 3 current subjects)</p>
                        <button class="start-quiz-btn" onclick="startAcademicQuiz()">Start Academic Quiz ‚Üí</button>
                    </div>
                    <div id="academicQuizContent"></div>
                    {% endif %}
                </div>
            </div>
        </main>
    </div>

    <script>
        let careerQuizData = null;
        let academicQuizData = null;
        let careerAnswers = [];
        let academicAnswers = [];

        // Career Quiz Functions
        async function startCareerQuiz() {
            document.getElementById('careerQuizContent').innerHTML = '<div class="loading">üîÑ Generating your career quiz...</div>';

            try {
                const response = await fetch('/api/generate-career-quiz', {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.completed) {
                    showCareerScore(data.score, data.ai_feedback);
                    return;
                }

                careerQuizData = data.quiz;
                careerAnswers = new Array(careerQuizData.questions.length).fill(null);
                renderCareerQuiz();
            } catch (error) {
                document.getElementById('careerQuizContent').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function renderCareerQuiz() {
            let html = '<div class="quiz-questions">';

            careerQuizData.questions.forEach((q, index) => {
                html += `
                    <div class="question-card">
                        <div class="question-number">Question ${index + 1} of ${careerQuizData.questions.length}</div>
                        <div class="question-text">${q.question}</div>
                        <div class="options">
                            ${q.options.map((option, optIndex) => `
                                <label class="option">
                                    <input type="radio" name="career_q${index}" value="${optIndex}" onchange="careerAnswers[${index}] = ${optIndex}">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            html += '</div><button class="submit-quiz-btn" onclick="submitCareerQuiz()">Submit Career Quiz</button>';
            document.getElementById('careerQuizContent').innerHTML = html;
        }

        async function submitCareerQuiz() {
            if (careerAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }

            try {
                const response = await fetch('/api/submit-career-quiz', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({answers: careerAnswers})
                });

                const data = await response.json();
                showCareerScore(data.score, data.ai_feedback);
            } catch (error) {
                alert('Error submitting quiz: ' + error.message);
            }
        }

        function showCareerScore(score, feedback) {
            // Reload page to show the completed card layout
            window.location.reload();
        }

        // Academic Quiz Functions
        async function startAcademicQuiz() {
            document.getElementById('academicQuizContent').innerHTML = '<div class="loading">üîÑ Generating your academic quiz...</div>';

            try {
                const response = await fetch('/api/generate-academic-quiz', {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.completed) {
                    showAcademicScore(data.score, data.ai_feedback);
                    return;
                }

                academicQuizData = data.quiz;
                academicAnswers = new Array(academicQuizData.questions.length).fill(null);
                renderAcademicQuiz();
            } catch (error) {
                document.getElementById('academicQuizContent').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function renderAcademicQuiz() {
            let html = '<div class="quiz-questions">';

            academicQuizData.questions.forEach((q, index) => {
                html += `
                    <div class="question-card">
                        <div class="question-number">Question ${index + 1} of ${academicQuizData.questions.length}</div>
                        <div class="subject-tag">${q.subject || 'General'}</div>
                        <div class="question-text">${q.question}</div>
                        <div class="options">
                            ${q.options.map((option, optIndex) => `
                                <label class="option">
                                    <input type="radio" name="academic_q${index}" value="${optIndex}" onchange="academicAnswers[${index}] = ${optIndex}">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            html += '</div><button class="submit-quiz-btn" onclick="submitAcademicQuiz()">Submit Academic Quiz</button>';
            document.getElementById('academicQuizContent').innerHTML = html;
        }

        async function submitAcademicQuiz() {
            if (academicAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }

            try {
                const response = await fetch('/api/submit-academic-quiz', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({answers: academicAnswers})
                });

                const data = await response.json();
                showAcademicScore(data.score, data.ai_feedback, data.subject_scores);
            } catch (error) {
                alert('Error submitting quiz: ' + error.message);
            }
        }

        function showAcademicScore(score, feedback, subjectScores) {
            // Reload page to show the completed card layout
            window.location.reload();
        }
    </script>
</body>
</html>
