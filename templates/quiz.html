<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Quiz - ForgeEd</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="app-container">
        <nav class="sidebar">
            <div class="logo">
                <h2>üéì ForgeEd</h2>
                <p>AI-Enhanced Learning</p>
            </div>
            <ul class="nav-links">
                <li><a href="/dashboard">üìä Dashboard</a></li>
                <li><a href="/courses">üìö My Courses</a></li>
                <li><a href="/career-learning">üéØ Career Learning</a></li>
                <li><a href="/quiz" class="active">üìù Daily Quiz</a></li>
                <li><a href="/wellbeing">üíö Wellbeing</a></li>
                <li><a href="/slu-gpt">üí¨ SLU GPT</a></li>
                <li><a href="/logout">üö™ Logout</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="page-header">
                <h1>üìù Daily Quiz</h1>
                <p>Test your knowledge with AI-generated quizzes</p>
            </div>

            <div class="quiz-sections">
                <!-- Career Learning Quiz -->
                <div class="quiz-section">
                    <div class="quiz-header-card">
                        <h2>üéØ Career Learning Quiz</h2>
                        <p>10 questions based on today's learning topic</p>
                        <button class="start-quiz-btn" onclick="startCareerQuiz()">Start Career Quiz ‚Üí</button>
                    </div>
                    <div id="careerQuizContent"></div>
                </div>

                <!-- Academic Quiz -->
                <div class="quiz-section">
                    <div class="quiz-header-card">
                        <h2>üìö Academic Quiz</h2>
                        <p>15 questions (5 from each of your 3 current subjects)</p>
                        <button class="start-quiz-btn" onclick="startAcademicQuiz()">Start Academic Quiz ‚Üí</button>
                    </div>
                    <div id="academicQuizContent"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let careerQuizData = null;
        let academicQuizData = null;
        let careerAnswers = [];
        let academicAnswers = [];

        // Career Quiz Functions
        async function startCareerQuiz() {
            document.getElementById('careerQuizContent').innerHTML = '<div class="loading">üîÑ Generating your career quiz...</div>';

            try {
                const response = await fetch('/api/generate-career-quiz', {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.completed) {
                    showCareerScore(data.score, data.ai_feedback);
                    return;
                }

                careerQuizData = data.quiz;
                careerAnswers = new Array(careerQuizData.questions.length).fill(null);
                renderCareerQuiz();
            } catch (error) {
                document.getElementById('careerQuizContent').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function renderCareerQuiz() {
            let html = '<div class="quiz-questions">';

            careerQuizData.questions.forEach((q, index) => {
                html += `
                    <div class="question-card">
                        <div class="question-number">Question ${index + 1} of ${careerQuizData.questions.length}</div>
                        <div class="question-text">${q.question}</div>
                        <div class="options">
                            ${q.options.map((option, optIndex) => `
                                <label class="option">
                                    <input type="radio" name="career_q${index}" value="${optIndex}" onchange="careerAnswers[${index}] = ${optIndex}">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            html += '</div><button class="submit-quiz-btn" onclick="submitCareerQuiz()">Submit Career Quiz</button>';
            document.getElementById('careerQuizContent').innerHTML = html;
        }

        async function submitCareerQuiz() {
            if (careerAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }

            try {
                const response = await fetch('/api/submit-career-quiz', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({answers: careerAnswers})
                });

                const data = await response.json();
                showCareerScore(data.score, data.ai_feedback);
            } catch (error) {
                alert('Error submitting quiz: ' + error.message);
            }
        }

        function showCareerScore(score, feedback) {
            const percentage = (score / 10) * 100;
            document.getElementById('careerQuizContent').innerHTML = `
                <div class="score-display">
                    <h2>‚úÖ Career Quiz Complete!</h2>
                    <div class="score-value">${score}/10</div>
                    <div class="score-percentage">${percentage}% Correct</div>
                    <div class="ai-feedback-box">
                        <h3>ü§ñ AI Feedback</h3>
                        <p>${feedback}</p>
                    </div>
                </div>
            `;
        }

        // Academic Quiz Functions
        async function startAcademicQuiz() {
            document.getElementById('academicQuizContent').innerHTML = '<div class="loading">üîÑ Generating your academic quiz...</div>';

            try {
                const response = await fetch('/api/generate-academic-quiz', {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.completed) {
                    showAcademicScore(data.score, data.ai_feedback);
                    return;
                }

                academicQuizData = data.quiz;
                academicAnswers = new Array(academicQuizData.questions.length).fill(null);
                renderAcademicQuiz();
            } catch (error) {
                document.getElementById('academicQuizContent').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function renderAcademicQuiz() {
            let html = '<div class="quiz-questions">';

            academicQuizData.questions.forEach((q, index) => {
                html += `
                    <div class="question-card">
                        <div class="question-number">Question ${index + 1} of ${academicQuizData.questions.length}</div>
                        <div class="subject-tag">${q.subject || 'General'}</div>
                        <div class="question-text">${q.question}</div>
                        <div class="options">
                            ${q.options.map((option, optIndex) => `
                                <label class="option">
                                    <input type="radio" name="academic_q${index}" value="${optIndex}" onchange="academicAnswers[${index}] = ${optIndex}">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            html += '</div><button class="submit-quiz-btn" onclick="submitAcademicQuiz()">Submit Academic Quiz</button>';
            document.getElementById('academicQuizContent').innerHTML = html;
        }

        async function submitAcademicQuiz() {
            if (academicAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }

            try {
                const response = await fetch('/api/submit-academic-quiz', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({answers: academicAnswers})
                });

                const data = await response.json();
                showAcademicScore(data.score, data.ai_feedback, data.subject_scores);
            } catch (error) {
                alert('Error submitting quiz: ' + error.message);
            }
        }

        function showAcademicScore(score, feedback, subjectScores) {
            const percentage = (score / 15) * 100;
            let subjectHtml = '';
            
            if (subjectScores) {
                subjectHtml = '<div class="subject-scores"><h4>Performance by Subject:</h4>';
                for (const [subject, scores] of Object.entries(subjectScores)) {
                    subjectHtml += `<div class="subject-score-item">${subject}: ${scores.correct}/${scores.total}</div>`;
                }
                subjectHtml += '</div>';
            }

            document.getElementById('academicQuizContent').innerHTML = `
                <div class="score-display">
                    <h2>‚úÖ Academic Quiz Complete!</h2>
                    <div class="score-value">${score}/15</div>
                    <div class="score-percentage">${percentage.toFixed(1)}% Correct</div>
                    ${subjectHtml}
                    <div class="ai-feedback-box">
                        <h3>ü§ñ AI Feedback</h3>
                        <p>${feedback}</p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
