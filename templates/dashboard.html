<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ForgeEd</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-logo">
                <h2>ForgeEd</h2>
                <p>AI-Enhanced LMS</p>
            </div>
            
            <div class="sidebar-nav">
                <a href="/dashboard" class="nav-item active">
                    <span>ğŸ </span> Dashboard
                </a>
                <a href="/courses" class="nav-item">
                    <span>ğŸ“š</span> My Courses
                </a>
                <a href="/career-learning" class="nav-item">
                    <span>ğŸ¯</span> Career Learning
                </a>
                <a href="/quiz" class="nav-item">
                    <span>âœï¸</span> Quizzes
                </a>
                <a href="/wellbeing" class="nav-item">
                    <span>ğŸ’š</span> Wellbeing
                </a>
                <a href="/slu-gpt" class="nav-item">
                    <span>ğŸ¤–</span> SLU GPT
                </a>
            </div>
            
            <div class="sidebar-footer">
                <a href="/logout" class="logout-btn">
                    <span>ğŸšª</span> Logout
                </a>
            </div>
        </nav>
        
        <main class="main-content">
            <div class="welcome-banner">
                <h2>Welcome back, {{ student['first_name'] }}! ğŸ‘‹</h2>
                <p>Here's what's happening with your studies today</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card blue">
                    <div class="stat-value">{{ enrolled_count }}</div>
                    <div class="stat-label">Enrolled Courses</div>
                    <span class="stat-badge">Active</span>
                </div>
                
                <div class="stat-card green">
                    <div class="stat-value">{{ "%.2f"|format(student['gpa']) }}</div>
                    <div class="stat-label">Current GPA</div>
                </div>
                
                <div class="stat-card purple">
                    <div class="stat-value">{{ student['completion_rate'] }}%</div>
                    <div class="stat-label">Completion Rate</div>
                </div>
                
                <div class="stat-card orange">
                    <div class="stat-value">{{ student['slu_gpt_sessions'] }}</div>
                    <div class="stat-label">SLU GPT Sessions</div>
                </div>
            </div>
            
            <div class="insights-section">
                <h3>AI-Powered Insights</h3>
                
                {% for insight in insights %}
                <div class="insight-card {{ insight.type }}">
                    {{ insight.text }}
                </div>
                {% endfor %}
            </div>
            
            <div class="insights-section">
                <h3>Upcoming Classes</h3>
                
                {% for course in upcoming_classes %}
                <div class="course-card" style="margin-bottom: 16px;">
                    <div class="course-header">
                        <div class="course-icon">ğŸ“–</div>
                        <div class="course-info">
                            <h3>{{ course['course_name'] }}</h3>
                            <p class="course-code">{{ course['instructor'] }}</p>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ course['progress'] }}%"></div>
                    </div>
                    <p class="progress-text">{{ course['progress'] }}% complete</p>
                </div>
                {% endfor %}
            </div>

            <div class="graphs-section">
                <h3>ğŸ“ˆ Your Performance Trends</h3>
                <div class="graphs-grid">
                    <div class="graph-card">
                        <h4>Career Quiz Scores</h4>
                        <canvas id="careerQuizChart"></canvas>
                    </div>
                    <div class="graph-card">
                        <h4>Academic Quiz Scores</h4>
                        <canvas id="academicQuizChart"></canvas>
                    </div>
                    <div class="graph-card">
                        <h4>Wellbeing Scores</h4>
                        <canvas id="wellbeingChart"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Fetch and render all graphs
        fetch('/api/dashboard-graph-data')
            .then(res => res.json())
            .then(data => {
                // Career Quiz Chart
                const careerDates = data.career_quiz.map(d => d.date);
                const careerScores = data.career_quiz.map(d => (d.score / d.total) * 100);
                
                new Chart(document.getElementById('careerQuizChart'), {
                    type: 'line',
                    data: {
                        labels: careerDates.length > 0 ? careerDates : ['No data yet'],
                        datasets: [{
                            label: 'Score (%)',
                            data: careerScores.length > 0 ? careerScores : [0],
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });

                // Academic Quiz Chart
                const academicDates = data.academic_quiz.map(d => d.date);
                const academicScores = data.academic_quiz.map(d => (d.score / d.total) * 100);
                
                new Chart(document.getElementById('academicQuizChart'), {
                    type: 'line',
                    data: {
                        labels: academicDates.length > 0 ? academicDates : ['No data yet'],
                        datasets: [{
                            label: 'Score (%)',
                            data: academicScores.length > 0 ? academicScores : [0],
                            borderColor: '#2196F3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });

                // Wellbeing Chart
                const wellbeingDates = data.wellbeing.map(d => d.date);
                const wellbeingScores = data.wellbeing.map(d => d.score);
                
                new Chart(document.getElementById('wellbeingChart'), {
                    type: 'line',
                    data: {
                        labels: wellbeingDates.length > 0 ? wellbeingDates : ['No data yet'],
                        datasets: [{
                            label: 'Wellbeing Score',
                            data: wellbeingScores.length > 0 ? wellbeingScores : [0],
                            borderColor: '#9C27B0',
                            backgroundColor: 'rgba(156, 39, 176, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            })
            .catch(err => console.error('Error loading graph data:', err));
    </script>
</body>
</html>
